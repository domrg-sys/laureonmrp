<div class="table-container">
    <table class="data-table">
        <thead>
            <tr>
                {% for header in table_headers %}
                    <th>{{ header }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for row in table_rows %}
                <tr>
                    {% for cell in row.cells %}
                        <td>{{ cell }}</td>
                    {% endfor %}
                    
                    {% if row.actions %}
                        <td class="table-actions">
                            {% for action in row.actions %}
                                
                                {# --- THIS IS THE CORRECTED LOGIC --- #}
                                {# If it's a modal trigger, ALWAYS render a button. #}
                                {% if action.modal_target %}
                                    <button type="button" 
                                            class="btn-icon {{ action.class }}" 
                                            title="{{ action.label }}"
                                            data-modal-target="{{ action.modal_target }}"
                                            {% if action.data %}data-action-info='{{ action.data }}'{% endif %}>
                                        <span class="material-symbols-outlined">{{ action.icon }}</span>
                                    </button>
                                
                                {# If it has a URL (and is not a modal), render a link. #}
                                {% elif action.url %}
                                    <a href="{{ action.url }}" 
                                       class="btn-icon {{ action.class }}" 
                                       title="{{ action.label }}">
                                        <span class="material-symbols-outlined">{{ action.icon }}</span>
                                    </a>

                                {# Otherwise, it's a disabled action. #}
                                {% else %}
                                    <span class="btn-icon {{ action.class }}" title="Permission Denied">
                                        <span class="material-symbols-outlined">{{ action.icon }}</span>
                                    </span>
                                {% endif %}

                            {% endfor %}
                        </td>
                    {% endif %}
                </tr>
            {% empty %}
                <tr>
                    <td colspan="{{ table_headers|length }}" class="table-empty">
                        No items to display.
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>